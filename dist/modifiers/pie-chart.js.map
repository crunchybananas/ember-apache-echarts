{"version":3,"file":"pie-chart.js","sources":["../../src/modifiers/pie-chart.ts"],"sourcesContent":["import AbstractChartModifier from './abstract-chart.ts';\nimport type { ECharts, SelectChangedPayload } from 'echarts';\nimport { PieChart, type PieSeriesOption } from 'echarts/charts';\nimport { TooltipComponent /*, type TooltipComponentOption */ } from 'echarts/components';\nimport { TitleComponent /*, type TitleComponentOption */ } from 'echarts/components';\nimport { LegendComponent /*, type LegendComponentOption */ } from 'echarts/components';\nimport { GridComponent /*, type GridComponentOption */ } from 'echarts/components';\nimport { DataZoomComponent /*, type DataZoomComponentOption */ } from 'echarts/components';\nimport { GraphicComponent /*, type GraphicComponentOption */ } from 'echarts/components';\nimport { CanvasRenderer } from 'echarts/renderers';\nimport { use } from 'echarts/core';\n\nuse([\n  CanvasRenderer,\n  PieChart,\n  TooltipComponent,\n  TitleComponent,\n  LegendComponent,\n  GridComponent,\n  DataZoomComponent,\n  GraphicComponent,\n]);\n\ntype ChartArgs = {\n  series?: PieSeriesOption[];\n  data?: unknown[];\n  tooltipFormatter?: (params: unknown) => string;\n  onSelect?: (name: string | null) => void;\n  variant?: 'pie' | 'donut';\n  noDataText?: string;\n};\n\n/**\n * Renders one or more pie charts.\n *\n * # Arguments\n *\n * `chartStyle`\n * : CSS properties for the entire chart including background color, border,\n *   margins and padding.\n *\n * `chartTitleStyle`\n * : CSS properties for the title for the entire chart including color, font,\n *   background color, border and alignment.\n *\n * `cellStyle`\n * : CSS properties defining the style for individual plots when rendering more\n *   than one series\n *\n * `cellTitleStyle`\n * : CSS properties defining the style for the titles for individual plots when\n *   rendering more than one series\n *\n * `maxColumns`\n * : The maximum number of columns to render when rendering more than one series\n *\n * `onSelect`\n * : Called when an element on a chart is selected\n *\n * `tooltipFormatter`\n * : The function used to generate the tool tip\n *\n * `variant`\n * : Whether to render a `pie` or a `donut`\n */\nexport default class PieChartModifier extends AbstractChartModifier {\n  // @ts-expect-error: follow up on this\n  configureChart(args: ChartArgs, chart: ECharts) {\n    const allSeries = args.series ?? [{ data: args.data }];\n    const { tooltipFormatter, onSelect } = args;\n    // @ts-expect-error: follow up on this\n    const { config } = this.buildLayout(args, chart);\n\n    chart.setOption({\n      ...config,\n      tooltip: {\n        formatter: tooltipFormatter,\n      },\n    });\n\n    chart.on('selectchanged', (event) => {\n      const { fromAction, fromActionPayload, isFromClick } = event as SelectChangedPayload;\n\n      if (!isFromClick) {\n        return;\n      }\n\n      const seriesIndex = fromActionPayload['seriesIndex'];\n      const dataIndex = fromActionPayload['dataIndexInside'];\n      const series = allSeries[seriesIndex];\n      // @ts-expect-error: follow up on this\n      const name = series.data[dataIndex] ? series.data[dataIndex].name : null;\n\n      if (name) {\n        chart.dispatchAction({\n          type: fromAction,\n          name,\n        });\n      }\n\n      onSelect && onSelect(fromAction === 'select' ? name : null);\n    });\n  }\n\n  /**\n   * Generates the plot config for a single plot on this chart.\n   */\n  // @ts-expect-error: until the abstract is typed this needs to wait\n  generatePlotConfig(series, layout, context) {\n    const { variant, noDataText } = context.args;\n\n    return (!series.data || series.data.length == 0) && noDataText\n      ? undefined\n      : {\n          series: [\n            {\n              type: 'pie',\n              ...(variant === 'donut' && {\n                radius: [(layout.innerHeight * 0.3) / 2, (layout.innerHeight * 0.7) / 2],\n              }),\n              center: [\n                layout.innerX + layout.innerWidth / 2 - 0.5,\n                layout.innerY + layout.innerHeight / 2 - 0.5,\n              ],\n              // if this is changed, update the select handler below\n              selectedMode: 'single',\n              data: series.data,\n            },\n          ],\n        };\n  }\n\n  /**\n   * Generates text to overlay on each cell of the chart, if any.\n   */\n  // @ts-expect-error: until the abstract is typed this needs to wait\n  generateTextOverlayConfig(series, args, layout, style) {\n    const { noDataText } = args;\n\n    return (!series.data || series.data.length == 0) && noDataText\n      ? this.generateTextConfig(\n          noDataText,\n          // @ts-expect-error: follow up on this\n          {\n            width: layout.innerWidth,\n            height: layout.innerHeight,\n            x: layout.innerX,\n            y: layout.innerY,\n          },\n          style\n        )\n      : undefined;\n  }\n}\n"],"names":["use","CanvasRenderer","PieChart","TooltipComponent","TitleComponent","LegendComponent","GridComponent","DataZoomComponent","GraphicComponent","PieChartModifier","AbstractChartModifier","configureChart","args","chart","allSeries","series","data","tooltipFormatter","onSelect","config","buildLayout","setOption","tooltip","formatter","on","event","fromAction","fromActionPayload","isFromClick","seriesIndex","dataIndex","name","dispatchAction","type","generatePlotConfig","layout","context","variant","noDataText","length","undefined","radius","innerHeight","center","innerX","innerWidth","innerY","selectedMode","generateTextOverlayConfig","style","generateTextConfig","width","height","x","y"],"mappings":"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"}